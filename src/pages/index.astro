---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all blog posts, filter out drafts, and sort by date (newest first)
const allPosts = await getCollection('blog');
const publishedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.publish_date.valueOf() - a.data.publish_date.valueOf());
---

<BaseLayout>
  <section class="hero">
    <h1>Hi there ðŸ‘‹!</h1>
    <p>I'm Caleb.</p>
    <p>This is where I writing about web development, tooling, my hobbies and/or whatever else interests me.</p>
  </section>

  <section class="posts">
    {publishedPosts.map(post => {
      const formattedDate = post.data.publish_date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });

      return (
        <article class="post-card">
          <a href={`/blog/${post.id.replace('.md', '')}`}>
            <h2>{post.data.title}</h2>
            <p class="post-description">{post.data.description}</p>
            <div class="post-meta">
              <time datetime={post.data.publish_date.toISOString()}>
                {formattedDate}
              </time>
              {post.data.tags && post.data.tags.length > 0 && (
                <>
                  <span class="separator">â€¢</span>
                  <span class="tags">{post.data.tags.join(', ')}</span>
                </>
              )}
            </div>
          </a>
        </article>
      );
    })}
  </section>
</BaseLayout>

<style>
  .hero {
    margin-bottom: 3rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid var(--color-border);
  }

  .hero h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  .hero p {
    font-size: 1.125rem;
    color: #666;
    margin: 0;
  }

  .posts {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .post-card {
    padding-bottom: 2rem;
  }

  .post-card a {
    text-decoration: none;
    color: var(--color-text);
    display: block;
  }

  .post-card a:hover h2 {
    color: var(--color-link);
  }

  .post-card h2 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    transition: color 0.2s;
  }

  .post-description {
    color: #333;
    margin-bottom: 0.75rem;
    line-height: 1.5;
  }

  .post-meta {
    font-size: 0.875rem;
    color: #666;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
  }

  .separator {
    color: #ccc;
  }

  .tags {
    font-size: 0.8125rem;
  }

  @media (max-width: 640px) {
    .hero h1 {
      font-size: 2rem;
    }

    .hero p {
      font-size: 1rem;
    }

    .post-card h2 {
      font-size: 1.25rem;
    }
  }
</style>
